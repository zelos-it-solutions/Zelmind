{% load static %}
{% load socialaccount %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Zelmind{% endblock %}</title>
  <link rel="icon" type="image/png" href="{% static 'authentication/images/zelmind_logo_cropped.png' %}">
  <link rel="stylesheet" href="{% static 'home_page/css/home.css' %}" />

  {% block extra_css %}{% endblock %}
</head>

<body data-google-calendar-icon-url="{% static 'home_page/images/google-calendar.png' %}"
  data-google-connect-url="{% url 'home_page:connect_google' %}?next={{ request.get_full_path|urlencode }}" {% if
  is_new_conversation_page %}data-is-new-conversation="true" data-welcome-message-text="{{ welcome_message_text }}" {%
  endif %}>
  <nav class="navbar">
    <button class="sidebar-toggle-btn nav-btn">â˜°</button>
    <a href="{% url 'home_page:new_conversation' %}" class="edit-btn">
      <img src="{% static 'home_page/images/edit.png' %}" alt="Edit" />
    </a>
    <div class="nav-user">
      <div class="avatar user-avatar">
        {% if request.user.first_name %}
        {{ request.user.first_name|slice:":1"|upper }}
        {% else %}
        {{ request.user.username|slice:":1"|upper }}
        {% endif %}
      </div>
      <span class="username">
        {% if request.user.get_full_name %}
        {{ request.user.get_full_name }}
        {% else %}
        {{ request.user.username }}
        {% endif %}
      </span>
    </div>

    <div class="nav-title">Zelmind</div>

    <!-- Right side controls (Settings + Logout) -->
    <div class="nav-controls">
      <a href="{% url 'home_page:settings' %}?next={{ request.path|urlencode }}" class="nav-action-link">Settings</a>
      <form method="post" action="{% url 'account_logout' %}" style="margin:0; display: flex; align-items: center;">
        {% csrf_token %}
        <button type="submit" class="nav-action-link">Logout</button>
      </form>
    </div>
  </nav>

  <div class="app-container">
    <div class="sidebar-wrapper">
      <aside class="sidebar">
        <a href="{% url 'home_page:new_conversation' %}" class="new-task-btn" style="text-decoration:none;">+ New
          Task</a>
        <div class="recents">
          <h3>Recents</h3>
          <ul id="recents-list">
            {% for convo in conversations %}
            {% if convo.id == "placeholder" %}
            <li data-placeholder="true" class="{% if not current_convo %}active{% endif %}">
              <a href="#" class="recent-link">New Chat</a>
            </li>
            {% else %}
            <li data-convo-id="{{ convo.id }}" data-delete-url="{% url 'home_page:delete_conversation' convo.id %}"
              class="{% if is_first_message %}active animate__fadeIn just-created{% else %}{% if convo.id == active_convo_id %}active{% endif %}{% endif %}">
              <a href="{% url 'home_page:assistant' convo.id %}" class="recent-link">{{ convo.title }}</a>
              <button class="delete-recent-btn">
                <img src="{% static 'home_page/images/delete.png' %}" alt="Delete">
              </button>
            </li>
            {% endif %}
            {% empty %}
          </ul>
          <p class="no-convos-msg">No conversations yet.</p>
          {% endfor %}
          </ul>
        </div>
      </aside>
    </div>

    {% block content %}
    {% if messages %}
    <div class="messages-container">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endblock %}
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="{% static 'home_page/js/home.js' %}"></script>
  {% block extra_js %}{% endblock %}
</body>

</html>